<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Meteor Dodge</title>
<style>
    body {
        margin: 0;
        background: rgb(101, 188, 207);
        overflow: hidden;
    }
    canvas {
        display: block;
        margin: auto;
        background: #d5d2af;
        border: 2px solid rgb(10, 10, 10);
    }
</style>
</head>
<body>

<canvas id="game" width="480" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ---------- PLAYER ---------- */
const player = {
    x: canvas.width / 2 - 40,
    y: canvas.height - 40,
    width: 80,
    height: 20,
    speed: 7
};

/* ---------- METEORS ---------- */
let meteors = [];
let meteorSpeed = 3;
let level = 1;

/* ---------- GAME STATE ---------- */
let score = 0;
let gameOver = false;

/* ---------- CONTROLS ---------- */
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/* ---------- CREATE METEOR ---------- */
function createMeteor() {
    meteors.push({
        x: Math.random() * (canvas.width - 78) + 10,
        y: -20,
        radius: 9
    });
}

/* ---------- DRAW ---------- */
function drawPlayer() {
    ctx.fillStyle = "blue";
    ctx.fillRect(player.x, player.y, player.width, player.height);
    ctx.strokeStyle = "blue";
    ctx.strokeRect(player.x, player.y, player.width, player.height);
}

function drawMeteor(m) {
    ctx.beginPath();
    ctx.arc(m.x, m.y, m.radius, 0, Math.PI * 2);
    ctx.fillStyle = "red";
    ctx.fill();
}

function drawScore() {
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("Score: " + score, 10, 25);
}

/* ---------- UPDATE ---------- */
function updatePlayer() {
    if (keys["ArrowLeft"] && player.x > 0) {
        player.x -= player.speed;
    }
    if (keys["ArrowRight"] && player.x < canvas.width - player.width) {
        player.x += player.speed;
    }
}

function updateMeteors() {
    meteors.forEach(m => m.y += meteorSpeed);

    meteors = meteors.filter(m => {
        if (m.y > canvas.height) {
            score++;
            return false;
        }
        return true;
    });
}

/* ---------- DIFFICULTY LOGIC ---------- */
function updateDifficulty() {
    if (score > 60 && level === 3) {
        meteorSpeed += 6;
        level = 4;
    } else if (score > 40 && level === 2) {
        meteorSpeed += 2;
        level = 3;
    } else if (score > 20 && level === 1) {
        meteorSpeed += 2;
        level = 2;
    }
}

/* ---------- COLLISION ---------- */
function collision(player, meteor) {
    return (
        meteor.x > player.x &&
        meteor.x < player.x + player.width &&
        meteor.y + meteor.radius > player.y
    );
}

/* ---------- GAME LOOP ---------- */
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gameOver) {
        ctx.fillStyle = "white";
        ctx.font = "32px Arial";
        ctx.fillText("GAME OVER", 130, 300);
        ctx.font = "20px Arial";
        ctx.fillText("Score: " + score, 180, 340);
        return;
    }

    drawPlayer();
    drawScore();

    meteors.forEach(m => {
        drawMeteor(m);
        if (collision(player, m)) gameOver = true;
    });

    updatePlayer();
    updateMeteors();
    updateDifficulty();

    requestAnimationFrame(gameLoop);
}

/* ---------- SPAWN METEORS ---------- */
setInterval(() => {
    if (!gameOver) {
        createMeteor();
    }
}, 700);

gameLoop();
</script>

</body>
</html>
